<body>
<script>
	sty();
	function sty()
		{
		add_Style('#item_button{width:69px;text-align:center;}');
		add_Style('#command_line{width:324px;height:25px;padding:3px;margin:5px;float-left;border:1px solid white;}');
		}
		
	function add_Style(styString)
		{
		var st = document.createElement('STYLE');
		t = document.createTextNode(styString);
		st.appendChild(t);
		document.head.appendChild(st);
		}
</script>

	<form action='wificonfig' method='POST'>
	<input id='' type='hidden' name='txtPage' value='Settings' placeholder=''/>
	<div id='container'>
		<div id='header'><h1>Vending Machine</h1></div>
		<div id='item-select'>	</div>
		<div id='tablespace'>	<div id='tables'></div>	</div>
		<div id='command_line'>	</div>
		<div id='footer'>		</div>
	</div>
<script>
	var total_Rows=0;
	var captions=['12','CAN1 Hot Water','CAN1 Feed Motor','CAN1 Spin Motor','CAN2 Hot Water','CAN2 Feed Motor','CAN2 Spin Motor','CAN3 Hot Water','CAN3 Feed Motor','CAN3 Spin Motor','Ex. Steam,''Ex. Milk','Hot Water'];
	var current_item=2;
	var cmd_name = 'fill';
	sty();
	get_captions();
	draw_form();
	fD(current_item);
	
	function draw_form()
		{
		var count=0;
		while(count<10)
			{
			add_Button(count,'b','text-align:center','','item-select','');
			count++;
			}
		var TR=0;
		var TC=0;
		var ind=0;
			add_Textbox(ind,'t','item_caption','width:150px;font-size:15px;text-align:center;margin:10px 5px 5px 5px','0','item-select');
			add_Button(98,'b','width:70px;','Test','item-select','');
			add_Button(99,'b','width:70px;','Save','item-select','');
			ind++;

		count=0;
		total_Rows=12;
		while(TR<total_Rows)
			{
			add_Textbox(TR,'rn','row_no','width:15px;text-align:right;background-color:lightgreen;',TR+1,'tables');
			add_Textbox(TR,'rc','row_cap','width:105px;text-align:left;background-color:lightgreen;',captions[TR],'tables');
			TC=0;
			while(TC<4)
				{
				add_Textbox(ind,'t','data_val','width:32px;text-align:right;',ind,'tables');
				TC ++;
				ind++;
				}
			TR++;
			CR=document.createElement('BR');
			document.getElementById('tables').appendChild(CR);
			}
		count=11;
		add_Button(count,'b','width:70px;','Status','command_line','status');
		}
		
	function get_captions()
		{
		const xhttp=new XMLHttpRequest();
		xhttp.onload=function()
			{
			var response=this.responseText;
			captions = response.split(',');
			}
		total_Rows = captions[0];
		var TR=1;
		while(TR<total_Rows)
			{
			var CR =  TR;
			TR++;
			captions[CR] = VArr[TR];
			}
		xhttp.open('POST', 'postData');
		xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		var sendData= 'Cmd_Name=';
		sendData+='getcaptions';
		sendData+='&ItemNo=';
		sendData+='x';
		sendData+='&ItemData=';
		sendData+='x';
		xhttp.send(sendData);
		}

	function add_Textbox(cnt,id_prefix,class_id,ex_sty,txtval,region)
		{
		t=document.createElement('INPUT');
		t.setAttribute('type','text');
		t.setAttribute('id',id_prefix+cnt);
		t.setAttribute('class',class_id);
		if((id_prefix=='rn')||(id_prefix=='rc'))
			{t.setAttribute('readonly','true');}
		if(txtval)
			t.setAttribute('value',txtval);
		if(ex_sty)
			t.setAttribute('style',ex_sty);
		document.getElementById(region).appendChild(t);
		}
	
	function add_Button(cnt,id_prefix,ex_sty,txtval,region,f_action)
		{
		id_prefix += cnt;
		var b=document.createElement('INPUT');
		if(f_action)
			{
			b.setAttribute('type','submit');
			b.setAttribute('formaction',f_action);
			}
		else
			{
			var clickfun='fD('+cnt+')';
			b.setAttribute('type','button');
			b.setAttribute('onclick',clickfun);
			}
		b.setAttribute('id',id_prefix);
		if(ex_sty)
			b.setAttribute('style',ex_sty);
		b.setAttribute('class','tbl_value');
		if(cnt==current_item)
			{
			b.setAttribute('style','background-color:tan;');
			}
		if(txtval)
			b.setAttribute('value',txtval);
		else
			b.setAttribute('value',cnt+1);
		document.getElementById(region).appendChild(b);cnt++;
		}

	function sD(cx)
		{
		const xhttp=new XMLHttpRequest();
		xhttp.onload=function()
			{
			var VArr;
			var response=this.responseText;
			if((cmd_name=='fill')||(cmd_name=='cancel')||(cmd_name=='default'))
				{
				VArr = response.split(',');
				while(cnt<49)
					{
					var yy = 't' + cnt;
					document.getElementById(yy).value = VArr[cnt];
					cnt++;
					}
				}
			}
		xhttp.open('POST', 'postData');
		xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		var cnt=0;
		var sendData= 'Cmd_Name=';
		sendData+=cmd_name;
		sendData+='&ItemNo=';
		sendData+=cx;
		sendData+='&ItemData=';
		if(cmd_name=='save')
			{
			while(cnt<49)
				{
				var yy='t'+cnt;
				sendData+=document.getElementById(yy).value;
				sendData+=',';
				cnt++;
				}
			
			}
		xhttp.send(sendData);
		}
	
	function fD(cx)
		{
		var zz = 'b'+current_item;
		if(cx==98)
			{cmd_name='test'; cx=current_item;}
		else if(cx==99)
			{cmd_name='save'; cx=current_item;}
		else
			{cmd_name='fill'; current_item = cx;}
		document.getElementById(zz).style = 'background-color:lightgrey;';
		zz = 'b'+cx;
		document.getElementById(zz).style = 'background-color:tan;';
		sD(cx);
		}
	</script>
</form>
</body>
</html>
